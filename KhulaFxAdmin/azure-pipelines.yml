trigger:
  - master
  - main

pool:
  name: Default

variables:
  - group: Deployment-Secrets

stages:
  - stage: Build
    jobs:
      - job: BuildJob
        steps:
          - checkout: self

          - task: UseDotNet@2
            displayName: Install .NET 8
            inputs:
              version: 8.x

          # ================================
          # Download KhulaFxTradeMonitor DLL
          # ================================
          - task: DownloadPipelineArtifact@2
            displayName: 'Download KhulaFxTradeMonitor DLL'
            inputs:
              source: 'specific'
              project: '$(System.TeamProject)'
              pipeline: <PipelineA_ID>   # <-- Replace with Pipeline A ID
              buildType: 'latest'
              artifact: 'KhulaFxTradeMonitorDLL'
              targetPath: '$(Build.SourcesDirectory)/KhulaFxAdmin/Libs'

          - task: DotNetCoreCLI@2
            displayName: Build Release
            inputs:
              command: build
              projects: KhulaFxAdmin/KhulaFxAdmin.csproj
              arguments: --configuration Release

          - task: DotNetCoreCLI@2
            displayName: Publish Release
            inputs:
              command: publish
              projects: KhulaFxAdmin/KhulaFxAdmin.csproj
              arguments: --configuration Release --output $(Build.ArtifactStagingDirectory) -p:PublishSingleFile=false

          - task: PublishBuildArtifacts@1
            displayName: Publish Artifacts
            inputs:
              pathToPublish: $(Build.ArtifactStagingDirectory)
              artifactName: backend
